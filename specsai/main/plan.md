# åç«¯æœåŠ¡ä¸“é¡¹æ¸…ç†ä¸åˆå¹¶è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°åç«¯æœåŠ¡çš„æ¸…ç†å’Œåˆå¹¶å·¥ä½œè®¾è®¡ï¼Œç›®æ ‡æ˜¯ï¼š
1. ç§»é™¤ä¸å¿…è¦çš„æµ‹è¯•æ–‡ä»¶å’Œæœªä½¿ç”¨çš„ä»£ç 
2. åˆå¹¶åŠŸèƒ½ç±»ä¼¼çš„æ–‡ä»¶ï¼Œå‡å°‘æ–‡ä»¶æ•°é‡
3. æå‡ä»£ç åº“çš„æ•´æ´åº¦å’Œå¯ç»´æŠ¤æ€§

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šæ–‡ä»¶æ¸…ç†

### 1. API æ¨¡å—é—ç•™ä»£ç 

#### 1.1 `src/api/core_api.py` - **å¾…åˆ é™¤**

**é—®é¢˜æè¿°**ï¼š
- è¯¥æ–‡ä»¶å£°ç§°æ˜¯"å…¼å®¹æ€§å«ç‰‡ï¼ˆcompatibility shimï¼‰"ï¼Œç”¨äºå‘åå…¼å®¹æ—§çš„å¯¼å…¥è·¯å¾„
- æ–‡ä»¶å†…å­˜åœ¨è¯­æ³•é”™è¯¯ï¼šä½¿ç”¨äº† `BaseModel`ã€`datetime`ã€`Optional` ç­‰ä½†æœªå¯¼å…¥
- `game_types_router` çš„è·¯ç”±å·²ç»åœ¨ `games.py` ä¸­å®ç°
- åœ¨ä»£ç åº“ä¸­æ²¡æœ‰å‘ç°ä»»ä½•å¯¹è¯¥æ–‡ä»¶çš„å¯¼å…¥å¼•ç”¨ï¼ˆé™¤è‡ªèº«æ³¨é‡Šå¤–ï¼‰

**å»ºè®®**ï¼šåˆ é™¤è¯¥æ–‡ä»¶

#### 1.2 `src/api/game_api.py` - **å¾…åˆ é™¤**

**é—®é¢˜æè¿°**ï¼š
- è¯¥æ–‡ä»¶æ ‡è®°ä¸º"Deprecated"ï¼Œå£°ç§°ä» `src.api.rooms` é‡æ–°å¯¼å‡º router
- ä½†å®é™…ä¸Šé‡æ–°å®šä¹‰äº†æ•´ä¸ª router å’Œæ‰€æœ‰ç«¯ç‚¹ï¼ˆ~433è¡Œä»£ç ï¼‰
- ä¸ `rooms.py` å­˜åœ¨å¤§é‡é‡å¤ä»£ç 
- `main.py` ç›´æ¥å¯¼å…¥ `rooms.py`ï¼Œæœªä½¿ç”¨æ­¤æ–‡ä»¶
- æ²¡æœ‰æµ‹è¯•æ–‡ä»¶å¼•ç”¨æ­¤æ¨¡å—

**å»ºè®®**ï¼šåˆ é™¤è¯¥æ–‡ä»¶

#### 1.3 `src/api/game_api_legacy.py` - **å¾…åˆ é™¤**

**é—®é¢˜æè¿°**ï¼š
- æ–‡ä»¶å­˜åœ¨ä½†ä¸ºç©º

**å»ºè®®**ï¼šåˆ é™¤è¯¥æ–‡ä»¶

### 2. æµ‹è¯•æ–‡ä»¶ç»„ç»‡é—®é¢˜

#### 2.1 `tests/test_player_service.py` - **å¾…ç§»åŠ¨**

**é—®é¢˜æè¿°**ï¼š
- è¯¥æ–‡ä»¶ä½äº `tests/` æ ¹ç›®å½•ä¸‹
- æ ¹æ®é¡¹ç›®çº¦å®šï¼ŒæœåŠ¡å±‚æµ‹è¯•åº”ä½äº `tests/unit/services/` ç›®å½•
- ç›®å‰ `tests/unit/services/` ç›®å½•ä¸‹æ²¡æœ‰ `PlayerService` çš„æµ‹è¯•

**å»ºè®®**ï¼šå°†æ–‡ä»¶ç§»åŠ¨åˆ° `tests/unit/services/test_player_service.py`

#### 2.2 `tests/performance/` ç›®å½• - **å¾…è¯„ä¼°**

**é—®é¢˜æè¿°**ï¼š
- åŒ…å« 3 ä¸ªæ€§èƒ½æµ‹è¯•æ–‡ä»¶
- æ²¡æœ‰ `__init__.py` æ–‡ä»¶

**å»ºè®®**ï¼šæ·»åŠ  `__init__.py` ä»¥ä¿æŒä¸€è‡´æ€§

### 3. é‡å¤è™šæ‹Ÿç¯å¢ƒ

#### 3.1 `backend/.venv/` å’Œ `backend/venv/`

**é—®é¢˜æè¿°**ï¼š
- å­˜åœ¨ä¸¤ä¸ªè™šæ‹Ÿç¯å¢ƒç›®å½•

**å»ºè®®**ï¼šä¿ç•™ `.venv/`ï¼ˆç¬¦åˆç°ä»£ Python é¡¹ç›®è§„èŒƒï¼‰ï¼Œåˆ é™¤ `venv/`ï¼ˆå¦‚æœä¸åœ¨ä½¿ç”¨ä¸­ï¼‰

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šæ–‡ä»¶åˆå¹¶

### åˆå¹¶åŸåˆ™

1. **åŠŸèƒ½å†…èš**ï¼šå°†åŠŸèƒ½é«˜åº¦ç›¸å…³çš„å°æ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶
2. **å‡å°‘ç¢ç‰‡**ï¼šé¿å…è¿‡å¤šçš„å°æ–‡ä»¶å¯¼è‡´ç»´æŠ¤å›°éš¾
3. **ä¿æŒæ¨¡å—è¾¹ç•Œ**ï¼šä¸è·¨è¶Šé€»è¾‘è¾¹ç•Œè¿›è¡Œåˆå¹¶
4. **å•ä¸€èŒè´£**ï¼šåˆå¹¶åçš„æ–‡ä»¶ä»éœ€ä¿æŒæ¸…æ™°çš„èŒè´£

### 1. Utils æ¨¡å—åˆå¹¶

#### å½“å‰ç»“æ„ (9 ä¸ªæ–‡ä»¶)
```
src/utils/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ config.py           # åº”ç”¨é…ç½®å’Œä¸­é—´ä»¶ (~200è¡Œ)
â”œâ”€â”€ errors.py           # è‡ªå®šä¹‰å¼‚å¸¸ (~127è¡Œ)
â”œâ”€â”€ logging_config.py   # æ—¥å¿—é…ç½®
â”œâ”€â”€ rate_limiter.py     # é€Ÿç‡é™åˆ¶å™¨ (~162è¡Œ)
â”œâ”€â”€ room_codes.py       # æˆ¿é—´ç ç”Ÿæˆ (~35è¡Œ)
â”œâ”€â”€ sanitization.py     # è¾“å…¥æ¸…ç† (~198è¡Œ)
â”œâ”€â”€ sessions.py         # ä¼šè¯ç®¡ç†å·¥å…· (~80è¡Œ)
â”œâ”€â”€ username_generator.py # ç”¨æˆ·åç”Ÿæˆ (~80è¡Œ)
â””â”€â”€ validation.py       # è¾“å…¥éªŒè¯ (~194è¡Œ)
```

#### åˆå¹¶æ–¹æ¡ˆ

| åˆå¹¶ç›®æ ‡ | æºæ–‡ä»¶ | ç†ç”± |
|---------|-------|------|
| `helpers.py` | `room_codes.py` + `username_generator.py` | éƒ½æ˜¯ç®€å•çš„ç”Ÿæˆå™¨å‡½æ•°ï¼ŒåŠŸèƒ½å•ä¸€ä¸”ç›¸å…³ |
| `input_processing.py` | `sanitization.py` + `validation.py` | éƒ½å¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œsanitization æ¸…ç†æ•°æ®ï¼Œvalidation éªŒè¯æ•°æ® |

#### åˆå¹¶åç»“æ„ (7 ä¸ªæ–‡ä»¶)
```
src/utils/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ config.py           # åº”ç”¨é…ç½®å’Œä¸­é—´ä»¶
â”œâ”€â”€ errors.py           # è‡ªå®šä¹‰å¼‚å¸¸
â”œâ”€â”€ logging_config.py   # æ—¥å¿—é…ç½®
â”œâ”€â”€ rate_limiter.py     # é€Ÿç‡é™åˆ¶å™¨
â”œâ”€â”€ helpers.py          # ğŸ†• æˆ¿é—´ç  + ç”¨æˆ·åç”Ÿæˆ (~115è¡Œ)
â”œâ”€â”€ input_processing.py # ğŸ†• è¾“å…¥æ¸…ç† + éªŒè¯ (~392è¡Œ)
â””â”€â”€ sessions.py         # ä¼šè¯ç®¡ç†å·¥å…·
```

**å‡å°‘æ–‡ä»¶æ•°**: 9 â†’ 7 (-2 ä¸ªæ–‡ä»¶)

### 2. Models æ¨¡å—åˆå¹¶

#### å½“å‰ç»“æ„ (11 ä¸ªæ–‡ä»¶)
```
src/models/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ ai_agent.py           # AI ä»£ç†æ¨¡å‹ (~40è¡Œ)
â”œâ”€â”€ base.py               # SQLAlchemy åŸºç±»
â”œâ”€â”€ game_room.py          # æ¸¸æˆæˆ¿é—´ (~90è¡Œ)
â”œâ”€â”€ game_room_participant.py # æˆ¿é—´å‚ä¸è€… (~55è¡Œ)
â”œâ”€â”€ game_session.py       # æ¸¸æˆä¼šè¯è®°å½• (~70è¡Œ)
â”œâ”€â”€ game_state.py         # æ¸¸æˆçŠ¶æ€ (~50è¡Œ)
â”œâ”€â”€ game_type.py          # æ¸¸æˆç±»å‹ (~30è¡Œ)
â”œâ”€â”€ player.py             # ç©å®¶æ¨¡å‹ (~55è¡Œ)
â”œâ”€â”€ player_profile.py     # ç©å®¶èµ„æ–™ (~50è¡Œ)
â””â”€â”€ session.py            # ç”¨æˆ·ä¼šè¯ (~45è¡Œ)
```

#### åˆå¹¶æ–¹æ¡ˆ

| åˆå¹¶ç›®æ ‡ | æºæ–‡ä»¶ | ç†ç”± |
|---------|-------|------|
| `game.py` | `game_room.py` + `game_room_participant.py` + `game_state.py` + `game_session.py` + `game_type.py` | éƒ½æ˜¯æ¸¸æˆç›¸å…³çš„æ ¸å¿ƒæ¨¡å‹ï¼Œå­˜åœ¨ç´§å¯†çš„å…³è”å…³ç³» |
| `user.py` | `player.py` + `player_profile.py` + `session.py` + `ai_agent.py` | éƒ½æ˜¯ç”¨æˆ·/å‚ä¸è€…ç›¸å…³æ¨¡å‹ |

#### åˆå¹¶åç»“æ„ (4 ä¸ªæ–‡ä»¶)
```
src/models/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ base.py      # SQLAlchemy åŸºç±»
â”œâ”€â”€ game.py      # ğŸ†• æ‰€æœ‰æ¸¸æˆç›¸å…³æ¨¡å‹ (~295è¡Œ)
â””â”€â”€ user.py      # ğŸ†• æ‰€æœ‰ç”¨æˆ·ç›¸å…³æ¨¡å‹ (~190è¡Œ)
```

**å‡å°‘æ–‡ä»¶æ•°**: 11 â†’ 4 (-7 ä¸ªæ–‡ä»¶)

### 3. API æ¨¡å—åˆå¹¶

#### å½“å‰ç»“æ„ (æ¸…ç†å 6 ä¸ªæ–‡ä»¶)
```
src/api/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ games.py         # æ¸¸æˆç±»å‹ API (~66è¡Œ)
â”œâ”€â”€ monitoring.py    # ç›‘æ§ API (~212è¡Œ)
â”œâ”€â”€ players.py       # ç©å®¶ API (~146è¡Œ)
â”œâ”€â”€ rooms.py         # æˆ¿é—´ API (~379è¡Œ)
â”œâ”€â”€ schemas.py       # Pydantic schemas (~100è¡Œ)
â””â”€â”€ sessions.py      # ä¼šè¯ API (~154è¡Œ)
```

#### åˆå¹¶æ–¹æ¡ˆ

| åˆå¹¶ç›®æ ‡ | æºæ–‡ä»¶ | ç†ç”± |
|---------|-------|------|
| `game_routes.py` | `games.py` + `rooms.py` | games åªæœ‰ 66 è¡Œï¼Œä¸ rooms éƒ½æ˜¯æ¸¸æˆç›¸å…³åŠŸèƒ½ï¼Œåˆå¹¶åä»ç„¶å¯ç®¡ç† |
| `user_routes.py` | `players.py` + `sessions.py` | éƒ½æ˜¯ç”¨æˆ·/ä¼šè¯ç›¸å…³çš„ API ç«¯ç‚¹ |

#### åˆå¹¶åç»“æ„ (5 ä¸ªæ–‡ä»¶)
```
src/api/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ game_routes.py   # ğŸ†• æ¸¸æˆç±»å‹ + æˆ¿é—´ API (~445è¡Œ)
â”œâ”€â”€ user_routes.py   # ğŸ†• ç©å®¶ + ä¼šè¯ API (~300è¡Œ)
â”œâ”€â”€ monitoring.py    # ç›‘æ§ API (ä¿ç•™ç‹¬ç«‹)
â””â”€â”€ schemas.py       # Pydantic schemas
```

**å‡å°‘æ–‡ä»¶æ•°**: 6 â†’ 5 (-1 ä¸ªæ–‡ä»¶)

### 4. Services æ¨¡å—åˆå¹¶

#### å½“å‰ç»“æ„ (6 ä¸ªæ–‡ä»¶)
```
src/services/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ ai_agent_service.py   # AI ä»£ç†æœåŠ¡ (~182è¡Œ)
â”œâ”€â”€ ai_scheduler.py       # AI è°ƒåº¦å™¨ (~145è¡Œ)
â”œâ”€â”€ game_room_service.py  # æˆ¿é—´æœåŠ¡ (~å¤§æ–‡ä»¶)
â”œâ”€â”€ game_state_service.py # æ¸¸æˆçŠ¶æ€æœåŠ¡
â”œâ”€â”€ player_service.py     # ç©å®¶æœåŠ¡
â””â”€â”€ games/
    â””â”€â”€ crime_scene_engine.py
```

#### åˆå¹¶æ–¹æ¡ˆ

| åˆå¹¶ç›®æ ‡ | æºæ–‡ä»¶ | ç†ç”± |
|---------|-------|------|
| `ai_service.py` | `ai_agent_service.py` + `ai_scheduler.py` | ä¸¤è€…åŠŸèƒ½ç´§å¯†ç›¸å…³ï¼Œscheduler ä¾èµ– agent_service |

#### åˆå¹¶åç»“æ„ (5 ä¸ªæ–‡ä»¶)
```
src/services/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ ai_service.py         # ğŸ†• AI ä»£ç† + è°ƒåº¦ (~327è¡Œ)
â”œâ”€â”€ game_room_service.py  # æˆ¿é—´æœåŠ¡
â”œâ”€â”€ game_state_service.py # æ¸¸æˆçŠ¶æ€æœåŠ¡
â”œâ”€â”€ player_service.py     # ç©å®¶æœåŠ¡
â””â”€â”€ games/
    â””â”€â”€ crime_scene_engine.py
```

**å‡å°‘æ–‡ä»¶æ•°**: 6 â†’ 5 (-1 ä¸ªæ–‡ä»¶)

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ¸…ç†ä¸åˆå¹¶æ¸…å•

### å¾…åˆ é™¤çš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | åŸå›  | å½±å“è¯„ä¼° |
|---------|------|---------|
| `backend/src/api/core_api.py` | é—ç•™å…¼å®¹æ€§æ–‡ä»¶ï¼Œæ— ä½¿ç”¨ï¼Œæœ‰è¯­æ³•é”™è¯¯ | æ— å½±å“ |
| `backend/src/api/game_api.py` | å·²åºŸå¼ƒï¼Œä¸ rooms.py é‡å¤ | æ— å½±å“ |
| `backend/src/api/game_api_legacy.py` | ç©ºæ–‡ä»¶ | æ— å½±å“ |

### å¾…åˆå¹¶çš„æ–‡ä»¶

| åˆå¹¶åæ–‡ä»¶ | æºæ–‡ä»¶ | è¡Œæ•°ä¼°è®¡ |
|-----------|-------|---------|
| `src/utils/helpers.py` | `room_codes.py` + `username_generator.py` | ~115 è¡Œ |
| `src/utils/input_processing.py` | `sanitization.py` + `validation.py` | ~392 è¡Œ |
| `src/models/game.py` | `game_room.py` + `game_room_participant.py` + `game_state.py` + `game_session.py` + `game_type.py` | ~295 è¡Œ |
| `src/models/user.py` | `player.py` + `player_profile.py` + `session.py` + `ai_agent.py` | ~190 è¡Œ |
| `src/api/game_routes.py` | `games.py` + `rooms.py` | ~445 è¡Œ |
| `src/api/user_routes.py` | `players.py` + `sessions.py` | ~300 è¡Œ |
| `src/services/ai_service.py` | `ai_agent_service.py` + `ai_scheduler.py` | ~327 è¡Œ |

### å¾…ç§»åŠ¨çš„æ–‡ä»¶

| æºè·¯å¾„ | ç›®æ ‡è·¯å¾„ | åŸå›  |
|-------|---------|------|
| `tests/test_player_service.py` | `tests/unit/services/test_player_service.py` | ç¬¦åˆç›®å½•ç»„ç»‡è§„èŒƒ |

### å¾…æ·»åŠ çš„æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | åŸå›  |
|---------|------|
| `tests/performance/__init__.py` | ä¿æŒ Python åŒ…ç»“æ„ä¸€è‡´æ€§ |

---

## ç¬¬å››éƒ¨åˆ†ï¼šæ‰§è¡Œæ­¥éª¤

### é˜¶æ®µ 1: æ¸…ç†é—ç•™æ–‡ä»¶

```bash
# 1.1 éªŒè¯åˆ é™¤å®‰å…¨æ€§
grep -r "core_api" backend/src backend/tests --include="*.py"
grep -r "game_api" backend/src backend/tests --include="*.py" | grep -v "game_api.py"
grep -r "game_api_legacy" backend/src backend/tests --include="*.py"

# 1.2 æ‰§è¡Œåˆ é™¤
rm backend/src/api/core_api.py
rm backend/src/api/game_api.py
rm backend/src/api/game_api_legacy.py
```

### é˜¶æ®µ 2: åˆå¹¶ Utils æ¨¡å—

```bash
# 2.1 åˆ›å»º helpers.py (åˆå¹¶ room_codes.py + username_generator.py)
# 2.2 åˆ›å»º input_processing.py (åˆå¹¶ sanitization.py + validation.py)
# 2.3 æ›´æ–°æ‰€æœ‰å¯¼å…¥å¼•ç”¨
# 2.4 åˆ é™¤åŸæ–‡ä»¶
# 2.5 è¿è¡Œæµ‹è¯•éªŒè¯
```

### é˜¶æ®µ 3: åˆå¹¶ Models æ¨¡å—

```bash
# 3.1 åˆ›å»º game.py (åˆå¹¶æ¸¸æˆç›¸å…³æ¨¡å‹)
# 3.2 åˆ›å»º user.py (åˆå¹¶ç”¨æˆ·ç›¸å…³æ¨¡å‹)
# 3.3 æ›´æ–° __init__.py å¯¼å‡º
# 3.4 æ›´æ–°æ‰€æœ‰å¯¼å…¥å¼•ç”¨
# 3.5 åˆ é™¤åŸæ–‡ä»¶
# 3.6 è¿è¡Œæµ‹è¯•éªŒè¯
```

### é˜¶æ®µ 4: åˆå¹¶ API æ¨¡å—

```bash
# 4.1 åˆ›å»º game_routes.py (åˆå¹¶ games.py + rooms.py)
# 4.2 åˆ›å»º user_routes.py (åˆå¹¶ players.py + sessions.py)
# 4.3 æ›´æ–° main.py ä¸­çš„è·¯ç”±æ³¨å†Œ
# 4.4 åˆ é™¤åŸæ–‡ä»¶
# 4.5 è¿è¡Œæµ‹è¯•éªŒè¯
```

### é˜¶æ®µ 5: åˆå¹¶ Services æ¨¡å—

```bash
# 5.1 åˆ›å»º ai_service.py (åˆå¹¶ ai_agent_service.py + ai_scheduler.py)
# 5.2 æ›´æ–°æ‰€æœ‰å¯¼å…¥å¼•ç”¨
# 5.3 åˆ é™¤åŸæ–‡ä»¶
# 5.4 è¿è¡Œæµ‹è¯•éªŒè¯
```

### é˜¶æ®µ 6: æµ‹è¯•æ–‡ä»¶æ•´ç†

```bash
# 6.1 ç§»åŠ¨æµ‹è¯•æ–‡ä»¶
mv backend/tests/test_player_service.py backend/tests/unit/services/

# 6.2 æ·»åŠ ç¼ºå¤±çš„ __init__.py
touch backend/tests/performance/__init__.py

# 6.3 è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
cd backend && pytest --tb=short
```

### é˜¶æ®µ 7: æœ€ç»ˆéªŒè¯

```bash
# 7.1 ä»£ç æ£€æŸ¥
cd backend
ruff check src/
ruff format src/

# 7.2 è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest

# 7.3 å¯åŠ¨æœåŠ¡éªŒè¯
uvicorn main:app --reload
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šåˆå¹¶åç»“æ„é¢„è§ˆ

```
backend/src/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ database.py
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ game_routes.py     # æ¸¸æˆç±»å‹ + æˆ¿é—´ API
â”‚   â”œâ”€â”€ user_routes.py     # ç©å®¶ + ä¼šè¯ API
â”‚   â”œâ”€â”€ monitoring.py      # ç›‘æ§ API
â”‚   â””â”€â”€ schemas.py         # Pydantic schemas
â”œâ”€â”€ integrations/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ llm_client.py
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py           # SQLAlchemy åŸºç±»
â”‚   â”œâ”€â”€ game.py           # æ¸¸æˆç›¸å…³æ¨¡å‹
â”‚   â””â”€â”€ user.py           # ç”¨æˆ·ç›¸å…³æ¨¡å‹
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ ai_service.py         # AI ä»£ç† + è°ƒåº¦
â”‚   â”œâ”€â”€ game_room_service.py
â”‚   â”œâ”€â”€ game_state_service.py
â”‚   â”œâ”€â”€ player_service.py
â”‚   â””â”€â”€ games/
â”‚       â””â”€â”€ crime_scene_engine.py
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py
â”‚   â”œâ”€â”€ errors.py
â”‚   â”œâ”€â”€ logging_config.py
â”‚   â”œâ”€â”€ rate_limiter.py
â”‚   â”œâ”€â”€ helpers.py           # æˆ¿é—´ç  + ç”¨æˆ·åç”Ÿæˆ
â”‚   â”œâ”€â”€ input_processing.py  # è¾“å…¥æ¸…ç† + éªŒè¯
â”‚   â””â”€â”€ sessions.py
â””â”€â”€ websocket/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ handlers.py
    â””â”€â”€ server.py
```

---

## ç¬¬å…­éƒ¨åˆ†ï¼šç»Ÿè®¡ä¸é£é™©è¯„ä¼°

### æ–‡ä»¶æ•°é‡å˜åŒ–

| æ¨¡å— | æ¸…ç†å‰ | æ¸…ç†å | å‡å°‘ |
|-----|-------|-------|------|
| api/ | 9 | 5 | -4 |
| models/ | 11 | 4 | -7 |
| services/ | 6 | 5 | -1 |
| utils/ | 9 | 7 | -2 |
| **æ€»è®¡** | **35** | **21** | **-14** |

### ä»£ç è¡Œæ•°å˜åŒ–

- **åˆ é™¤é—ç•™ä»£ç **: ~540 è¡Œ
- **åˆå¹¶é‡ç»„**: ä»£ç é‡åŸºæœ¬ä¸å˜ï¼Œä½†ç»„ç»‡æ›´ç´§å‡‘

### é£é™©è¯„ä¼°

| é£é™©é¡¹ | ç­‰çº§ | ç¼“è§£æªæ–½ |
|-------|-----|---------|
| å¯¼å…¥è·¯å¾„å˜æ›´å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ | ä¸­ | å…¨é¢æ›´æ–°å¯¼å…¥ã€æµ‹è¯•è¦†ç›– |
| åˆå¹¶åæ–‡ä»¶è¿‡å¤§éš¾ä»¥ç»´æŠ¤ | ä½ | æ§åˆ¶å•æ–‡ä»¶ä¸è¶…è¿‡ 500 è¡Œ |
| å¾ªç¯å¯¼å…¥é—®é¢˜ | ä¸­ | ä½¿ç”¨ TYPE_CHECKING å»¶è¿Ÿå¯¼å…¥ |
| æµ‹è¯•å¤±è´¥ | ä¸­ | åˆ†é˜¶æ®µæ‰§è¡Œï¼Œæ¯é˜¶æ®µéªŒè¯ |

---

## æ€»ç»“

æœ¬æ¬¡æ¸…ç†ä¸åˆå¹¶å·¥ä½œä¸»è¦æ¶‰åŠï¼š

### æ¸…ç†
- **åˆ é™¤ 3 ä¸ªé—ç•™/åºŸå¼ƒçš„ API æ–‡ä»¶**
- **ç§»åŠ¨ 1 ä¸ªæµ‹è¯•æ–‡ä»¶åˆ°æ­£ç¡®ä½ç½®**
- **æ·»åŠ  1 ä¸ª `__init__.py` æ–‡ä»¶**

### åˆå¹¶
- **Utils æ¨¡å—**: åˆå¹¶ 4 ä¸ªæ–‡ä»¶ä¸º 2 ä¸ª
- **Models æ¨¡å—**: åˆå¹¶ 9 ä¸ªæ–‡ä»¶ä¸º 2 ä¸ª
- **API æ¨¡å—**: åˆå¹¶ 4 ä¸ªæ–‡ä»¶ä¸º 2 ä¸ª
- **Services æ¨¡å—**: åˆå¹¶ 2 ä¸ªæ–‡ä»¶ä¸º 1 ä¸ª

### æ•ˆæœ
- **å‡å°‘ 14 ä¸ªæºä»£ç æ–‡ä»¶** (35 â†’ 21)
- **åˆ é™¤çº¦ 540 è¡Œå†—ä½™ä»£ç **
- **æå‡ä»£ç ç»„ç»‡çš„ç´§å‡‘æ€§å’Œå¯ç»´æŠ¤æ€§**

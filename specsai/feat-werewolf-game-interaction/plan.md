# ç‹¼äººæ€æ¸¸æˆäº¤äº’å¢å¼º - æŠ€æœ¯è®¾è®¡æ–‡æ¡£

## 1. è®¾è®¡æ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

åŸºäºç°æœ‰çš„ç‹¼äººæ€æ¸¸æˆæ¶æ„ï¼Œå¢å¼ºæ¸¸æˆäº¤äº’åŠŸèƒ½ï¼Œå®ç°ï¼š
1. æ¸¸æˆæ‰‹åŠ¨å¼€å§‹æ§åˆ¶
2. æ¸¸æˆæš‚åœ/ç»§ç»­åŠŸèƒ½
3. å®æ—¶æ¸¸æˆæ—¥å¿—ï¼ˆå«æ—¥å¿—çº§åˆ«åˆ‡æ¢ï¼‰
4. ç©å®¶å‘è¨€è¾“å…¥ä¸ AI äº¤äº’
5. AI å‘è¨€æ°”æ³¡å®æ—¶æ˜¾ç¤º
6. **ä¸»æŒäººå…¨ç¨‹æµç¨‹æ§åˆ¶ä¸å‘è¨€å±•ç¤º**

### 1.2 æ ¸å¿ƒè®¾è®¡ç†å¿µï¼šä¸»æŒäººä¸­å¿ƒåˆ¶

æ•´ä¸ªç‹¼äººæ€æ¸¸æˆæµç¨‹ç”± **AI ä¸»æŒäºº (WerewolfHost)** ç»Ÿä¸€æ§åˆ¶å’Œè§£è¯´ï¼š

- **æµç¨‹æ§åˆ¶**ï¼šä¸»æŒäººå†³å®šæ¸¸æˆé˜¶æ®µçš„æ¨è¿›ï¼ˆå¤œæ™šâ†’å¤©äº®â†’è®¨è®ºâ†’æŠ•ç¥¨ï¼‰
- **å…¬å‘Šæ’­æŠ¥**ï¼šæ‰€æœ‰é‡è¦äº‹ä»¶ç”±ä¸»æŒäººå…¬å‘Šï¼ˆæµå¼è¾“å‡ºï¼Œæ‰“å­—æœºæ•ˆæœï¼‰
- **å‘è¨€å¼•å¯¼**ï¼šä¸»æŒäººæŒ‡å®šç©å®¶å‘è¨€é¡ºåºï¼ŒåŒ…æ‹¬è¯·æ±‚äººç±»ç©å®¶å‘è¨€
- **ç»“æœå®£å¸ƒ**ï¼šæ­»äº¡ã€æŠ•ç¥¨ç»“æœã€æ¸¸æˆèƒœè´Ÿç”±ä¸»æŒäººå®£å¸ƒ

### 1.3 æŠ€æœ¯æ ˆ

ä¸¥æ ¼ä½¿ç”¨é¡¹ç›®ç°æœ‰æŠ€æœ¯æ ˆï¼š
- **åç«¯**: FastAPI + python-socketio + SQLAlchemy
- **å‰ç«¯**: Vue 3 + Pinia + Element Plus + Socket.IO Client
- **é€šä¿¡**: WebSocket (Socket.IO) å®æ—¶åŒå‘é€šä¿¡
- **AI ä¸»æŒäºº**: WerewolfHost (åŸºäº LLM çš„ä¸»æŒäºº Agent)

### 1.4 è®¾è®¡åŸåˆ™

- å¤ç”¨ç°æœ‰ç»„ä»¶å’ŒæœåŠ¡ï¼Œä¸é‡å¤é€ è½®å­
- ä¿æŒä¸ç°æœ‰ä»£ç é£æ ¼ä¸€è‡´
- æœ€å°åŒ–æ”¹åŠ¨èŒƒå›´ï¼Œä¸“æ³¨äºéœ€æ±‚åŠŸèƒ½
- **ä¸»æŒäººä½œä¸ºæ¸¸æˆæµç¨‹çš„å”¯ä¸€æ§åˆ¶è€…**

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Frontend (Vue 3)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  WerewolfGameView.vue                                           â”‚
â”‚  â”œâ”€â”€ GameControlBar (æ–°å¢)       - å¼€å§‹/æš‚åœ/ç»§ç»­æŒ‰é’®            â”‚
â”‚  â”œâ”€â”€ HostAnnouncementPanel (å¢å¼º) - ä¸»æŒäººå‘è¨€å±•ç¤ºåŒºï¼ˆå¸¸é©»ï¼‰      â”‚
â”‚  â”œâ”€â”€ SeatCircle.vue              - åº§ä½åœˆ + AIå‘è¨€æ°”æ³¡           â”‚
â”‚  â”‚   â””â”€â”€ PlayerSeat.vue          - ç©å®¶åº§ä½ + æ°”æ³¡ç»„ä»¶           â”‚
â”‚  â”œâ”€â”€ GameLog.vue (å¢å¼º)          - æ—¥å¿—æ˜¾ç¤º + çº§åˆ«åˆ‡æ¢           â”‚
â”‚  â””â”€â”€ PlayerInputBar (æ–°å¢)       - ç©å®¶å‘è¨€è¾“å…¥æ¡†                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Stores (Pinia)                                                  â”‚
â”‚  â”œâ”€â”€ game.js (å¢å¼º)              - æ¸¸æˆçŠ¶æ€ + ä¸»æŒäººçŠ¶æ€          â”‚
â”‚  â””â”€â”€ socket.js (å¢å¼º)            - WebSocket äº‹ä»¶å¤„ç†            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚ WebSocket (Socket.IO)
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Backend (FastAPI)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  API Routes                                                      â”‚
â”‚  â””â”€â”€ werewolf_routes.py (å¢å¼º)   - å¼€å§‹/æš‚åœ/ç»§ç»­/å‘è¨€ API       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  WebSocket Handlers                                              â”‚
â”‚  â””â”€â”€ werewolf_handlers.py (å¢å¼º) - ä¸»æŒäººå…¬å‘Š + ç©å®¶å‘è¨€äº‹ä»¶      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Services                                                        â”‚
â”‚  â””â”€â”€ werewolf_game_service.py (å¢å¼º)                             â”‚
â”‚      â”œâ”€â”€ ä¸»æŒäººæµç¨‹æ§åˆ¶ï¼ˆæ ¸å¿ƒï¼‰                                   â”‚
â”‚      â”œâ”€â”€ æ¸¸æˆæš‚åœ/ç»§ç»­é€»è¾‘                                       â”‚
â”‚      â”œâ”€â”€ ç©å®¶å‘è¨€å¤„ç† + ä¸Šä¸‹æ–‡æ„å»º                               â”‚
â”‚      â””â”€â”€ AI å‘è¨€æµå¼è¾“å‡º                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AI Agents                                                       â”‚
â”‚  â”œâ”€â”€ WerewolfHost (ä¸»æŒäºº)       - æµç¨‹æ§åˆ¶ + å…¬å‘Šç”Ÿæˆ            â”‚
â”‚  â””â”€â”€ å„è§’è‰² Agent                - æ¥æ”¶ç©å®¶å‘è¨€ä½œä¸ºä¸Šä¸‹æ–‡         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ä¸»æŒäººæ§åˆ¶æµç¨‹

```
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚   WerewolfHost      â”‚
                     â”‚   (AI ä¸»æŒäºº)        â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                          â”‚                          â”‚
    â–¼                          â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æµç¨‹æ§åˆ¶ â”‚              â”‚ å…¬å‘Šæ’­æŠ¥ â”‚              â”‚ å‘è¨€å¼•å¯¼ â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                        â”‚                        â”‚
     â”‚  å†³å®šé˜¶æ®µæ¨è¿›          â”‚  æµå¼è¾“å‡ºå…¬å‘Š          â”‚  æŒ‡å®šå‘è¨€é¡ºåº
     â”‚  - å¤œæ™šå¼€å§‹            â”‚  - æ¸¸æˆå¼€å§‹            â”‚  - ç‚¹åç©å®¶å‘è¨€
     â”‚  - å¤©äº®                â”‚  - å¤œæ™š/å¤©äº®           â”‚  - ç­‰å¾…äººç±»ç©å®¶
     â”‚  - è®¨è®º/æŠ•ç¥¨           â”‚  - æ­»äº¡å…¬å‘Š            â”‚  - AI ç©å®¶å‘è¨€
     â”‚  - æ¸¸æˆç»“æŸ            â”‚  - æŠ•ç¥¨ç»“æœ            â”‚
     â”‚                        â”‚  - èƒœè´Ÿå®£å¸ƒ            â”‚
     â–¼                        â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¸¸æˆçŠ¶æ€ (WerewolfGameState)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æ•°æ®æµè®¾è®¡

#### 2.3.1 æ¸¸æˆå¼€å§‹æµç¨‹ï¼ˆä¸»æŒäººä¸»å¯¼ï¼‰

```
ç”¨æˆ·ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"
    â”‚
    â–¼
Frontend: emit('werewolf:start_game', { room_code })
    â”‚
    â–¼
Backend: werewolf_handlers.py æ¥æ”¶äº‹ä»¶
    â”‚
    â–¼
WerewolfGameService.start_game()
    â”‚
    â”œâ”€â”€ åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€
    â”œâ”€â”€ åˆ›å»º AI Agentsï¼ˆåŒ…æ‹¬ä¸»æŒäººï¼‰
    â”‚
    â–¼
ã€ä¸»æŒäººå…¬å‘Šï¼šæ¸¸æˆå¼€å§‹ã€‘
WerewolfHost.announce_game_start() (æµå¼)
    â”‚
    â”œâ”€â”€ emit('werewolf:host_announcement_start')
    â”œâ”€â”€ emit('werewolf:host_announcement_chunk') Ã— N
    â””â”€â”€ emit('werewolf:host_announcement_end')
    â”‚
    â–¼ Frontend:
        â”œâ”€â”€ HostAnnouncementPanel æ˜¾ç¤ºä¸»æŒäººå‘è¨€ï¼ˆæ‰“å­—æœºæ•ˆæœï¼‰
        â””â”€â”€ GameLog è®°å½•ä¸»æŒäººå…¬å‘Š
    â”‚
    â–¼
ã€ä¸»æŒäººå…¬å‘Šï¼šå¤œå¹•é™ä¸´ã€‘
WerewolfHost.announce_night() (æµå¼)
    â”‚
    â–¼
å¼€å§‹ç¬¬ä¸€ä¸ªå¤œæ™šè¡ŒåŠ¨...
```

#### 2.3.2 å®Œæ•´æ¸¸æˆå›åˆæµç¨‹ï¼ˆä¸»æŒäººæ§åˆ¶ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¤œæ™šé˜¶æ®µ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€ä¸»æŒäººã€‘"å¤œå¹•é™ä¸´ï¼Œç¬¬Nå¤©çš„å¤œæ™šå¼€å§‹äº†ï¼Œæ‰€æœ‰ç©å®¶è¯·é—­çœ¼ã€‚"        â”‚
â”‚       â”‚                                                        â”‚
â”‚       â”œâ”€â”€ ã€ä¸»æŒäººã€‘"ç‹¼äººè¯·ççœ¼..."                             â”‚
â”‚       â”‚       â””â”€â”€ ç‹¼äººè¡ŒåŠ¨ï¼ˆAIè‡ªåŠ¨/äººç±»ç­‰å¾…ï¼‰                    â”‚
â”‚       â”‚                                                        â”‚
â”‚       â”œâ”€â”€ ã€ä¸»æŒäººã€‘"ç‹¼äººè¯·é—­çœ¼ï¼Œé¢„è¨€å®¶è¯·ççœ¼..."                â”‚
â”‚       â”‚       â””â”€â”€ é¢„è¨€å®¶è¡ŒåŠ¨                                    â”‚
â”‚       â”‚                                                        â”‚
â”‚       â””â”€â”€ ã€ä¸»æŒäººã€‘"é¢„è¨€å®¶è¯·é—­çœ¼ï¼Œå¥³å·«è¯·ççœ¼..."                â”‚
â”‚               â””â”€â”€ å¥³å·«è¡ŒåŠ¨                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¤©äº®é˜¶æ®µ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€ä¸»æŒäººã€‘"å¤©äº®äº†ï¼Œæ˜¨æ™š Xå·ç©å®¶ è¢«æ€å®³..."                       â”‚
â”‚       â”‚    (å¦‚æœ‰æ­»äº¡ï¼Œå…¬å¸ƒæ­»è€…ä¿¡æ¯ï¼›å¦‚æ— ï¼Œå®£å¸ƒå¹³å®‰å¤œ)             â”‚
â”‚       â”‚                                                        â”‚
â”‚       â””â”€â”€ æ£€æŸ¥èƒœè´Ÿæ¡ä»¶                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è®¨è®ºé˜¶æ®µ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€ä¸»æŒäººã€‘"è¯·å„ä½ç©å®¶ä¾æ¬¡å‘è¨€ï¼Œä»1å·å¼€å§‹ã€‚"                      â”‚
â”‚       â”‚                                                        â”‚
â”‚       â”œâ”€â”€ ã€ä¸»æŒäººã€‘"è¯·1å·ç©å®¶å‘è¨€ã€‚"                            â”‚
â”‚       â”‚       â””â”€â”€ AI/äººç±»ç©å®¶å‘è¨€ + æ°”æ³¡æ˜¾ç¤º                     â”‚
â”‚       â”‚                                                        â”‚
â”‚       â”œâ”€â”€ ã€ä¸»æŒäººã€‘"è¯·2å·ç©å®¶å‘è¨€ã€‚"                            â”‚
â”‚       â”‚       â””â”€â”€ AI/äººç±»ç©å®¶å‘è¨€                               â”‚
â”‚       â”‚                                                        â”‚
â”‚       â””â”€â”€ ... ä¾æ¬¡è¿›è¡Œ                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æŠ•ç¥¨é˜¶æ®µ                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€ä¸»æŒäººã€‘"å‘è¨€ç»“æŸï¼Œè¯·æŠ•ç¥¨é€‰å‡ºä»Šå¤©è¦æ”¾é€çš„ç©å®¶ã€‚"               â”‚
â”‚       â”‚                                                        â”‚
â”‚       â”œâ”€â”€ å„ç©å®¶æŠ•ç¥¨                                            â”‚
â”‚       â”‚                                                        â”‚
â”‚       â””â”€â”€ ã€ä¸»æŒäººã€‘"æŠ•ç¥¨ç»“æŸï¼ŒXå·ç©å®¶ä»¥Nç¥¨è¢«æ”¾é€..."            â”‚
â”‚                   (æˆ– "å¹³ç¥¨ï¼Œæ— äººå‡ºå±€")                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                      è¿›å…¥ä¸‹ä¸€ä¸ªå¤œæ™š æˆ– æ¸¸æˆç»“æŸ
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ¸¸æˆç»“æŸï¼ˆå¦‚è§¦å‘ï¼‰                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ã€ä¸»æŒäººã€‘"æ¸¸æˆç»“æŸï¼ç‹¼äººé˜µè¥/å¥½äººé˜µè¥è·èƒœï¼                     â”‚
â”‚            ç‹¼äººæ˜¯ï¼šXå·ã€Yå·ã€Zå·...                              â”‚
â”‚            æ­å–œè·èƒœæ–¹ï¼"                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.3.3 æš‚åœ/ç»§ç»­æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"æš‚åœ"
    â”‚
    â–¼
Frontend: emit('werewolf:pause_game', { room_code })
    â”‚
    â–¼
Backend: 
    â”œâ”€â”€ è®¾ç½® is_paused = True
    â”œâ”€â”€ ç­‰å¾…å½“å‰è¡ŒåŠ¨å®Œæˆï¼ˆå«ä¸»æŒäººå‘è¨€ï¼‰
    â””â”€â”€ å¹¿æ’­ werewolf:game_paused
    â”‚
    â–¼
Frontend: 
    â”œâ”€â”€ æ›´æ–° isPaused çŠ¶æ€
    â””â”€â”€ æ˜¾ç¤ºæš‚åœé®ç½©

ç”¨æˆ·ç‚¹å‡»"ç»§ç»­"
    â”‚
    â–¼
Frontend: emit('werewolf:resume_game', { room_code })
    â”‚
    â–¼
Backend: 
    â”œâ”€â”€ è®¾ç½® is_paused = False
    â”œâ”€â”€ ä¸»æŒäººç»§ç»­æµç¨‹
    â””â”€â”€ å¹¿æ’­ werewolf:game_resumed
```

#### 2.3.4 ç©å®¶å‘è¨€æµç¨‹ï¼ˆä¸»æŒäººå¼•å¯¼ï¼‰

```
ä¸»æŒäººè½®åˆ°æŸç©å®¶å‘è¨€
    â”‚
    â–¼
ã€ä¸»æŒäººå…¬å‘Šã€‘"è¯·Xå·ç©å®¶å‘è¨€ã€‚" (æµå¼è¾“å‡º)
    â”‚
    â–¼
Backend: emit('werewolf:request_speech', { player_id, seat_number })
    â”‚
    â–¼
Frontend: 
    â”œâ”€â”€ æ˜¾ç¤ºä¸»æŒäººç‚¹åå…¬å‘Š
    â”œâ”€â”€ å¦‚æœæ˜¯äººç±»ç©å®¶ï¼šå¯ç”¨è¾“å…¥æ¡†
    â”œâ”€â”€ æ˜¾ç¤º"è¯·å‘è¨€"æç¤º
    â””â”€â”€ å¯åŠ¨æé†’è®¡æ—¶å™¨ï¼ˆæ¯30ç§’æé†’ä¸€æ¬¡ï¼‰
    â”‚
ç”¨æˆ·è¾“å…¥å‘è¨€å†…å®¹ï¼Œç‚¹å‡»å‘é€
    â”‚
    â–¼
Frontend: emit('werewolf:player_speech', { room_code, content })
    â”‚
    â–¼
Backend: WerewolfGameService.process_player_speech()
    â”œâ”€â”€ è®°å½•å‘è¨€åˆ° game_log
    â”œâ”€â”€ å¹¿æ’­ werewolf:speech_end (å®Œæ•´å‘è¨€)
    â”œâ”€â”€ æ›´æ–° AI Agents çš„ä¸Šä¸‹æ–‡
    â””â”€â”€ ä¸»æŒäººç‚¹åä¸‹ä¸€ä½å‘è¨€
    â”‚
    â–¼
Frontend: 
    â”œâ”€â”€ ç¦ç”¨è¾“å…¥æ¡†
    â”œâ”€â”€ åœ¨æ—¥å¿—æ˜¾ç¤ºç©å®¶å‘è¨€
    â””â”€â”€ åœ¨ç©å®¶åº§ä½æ˜¾ç¤ºå‘è¨€æ°”æ³¡
```

#### 2.3.5 AI å‘è¨€æµç¨‹ï¼ˆå«æ°”æ³¡æ˜¾ç¤ºï¼‰

```
ä¸»æŒäººç‚¹å AI ç©å®¶å‘è¨€
    â”‚
    â–¼
ã€ä¸»æŒäººå…¬å‘Šã€‘"è¯·Xå·ç©å®¶å‘è¨€ã€‚"
    â”‚
    â–¼
Backend: WerewolfGameService._execute_ai_speech()
    â”‚
    â”œâ”€â”€ emit('werewolf:speech_start', { speaker_seat, speaker_name })
    â”‚   â”‚
    â”‚   â–¼ Frontend: 
    â”‚       â”œâ”€â”€ è®¾ç½® speakingPlayerId
    â”‚       â”œâ”€â”€ åœ¨ PlayerSeat æ˜¾ç¤ºæ°”æ³¡ï¼ˆç©ºå†…å®¹ï¼‰
    â”‚       â””â”€â”€ åœ¨ GameLog æ·»åŠ æµå¼æ—¥å¿—
    â”‚
    â”œâ”€â”€ AI Agent ç”Ÿæˆå‘è¨€ï¼ˆæµå¼ï¼Œå«ç©å®¶å‘è¨€ä¸Šä¸‹æ–‡ï¼‰
    â”‚   â”‚
    â”‚   â””â”€â”€ å¾ªç¯ emit('werewolf:speech_chunk', { speaker_seat, chunk, accumulated })
    â”‚       â”‚
    â”‚       â–¼ Frontend:
    â”‚           â”œâ”€â”€ æ›´æ–°æ°”æ³¡å†…å®¹ï¼ˆæ‰“å­—æœºæ•ˆæœï¼‰
    â”‚           â””â”€â”€ æ›´æ–°æ—¥å¿—å†…å®¹
    â”‚
    â””â”€â”€ emit('werewolf:speech_end', { speaker_seat, content })
        â”‚
        â–¼ Frontend:
            â”œâ”€â”€ å®Œæˆæ°”æ³¡æ˜¾ç¤º
            â”œâ”€â”€ å¯åŠ¨ 5 ç§’æ¶ˆå¤±è®¡æ—¶å™¨
            â””â”€â”€ å®Œæˆæ—¥å¿—è®°å½•
    â”‚
    â–¼
ä¸»æŒäººç‚¹åä¸‹ä¸€ä½å‘è¨€...
```

## 3. æ¥å£è®¾è®¡

### 3.1 ä¸»æŒäººå…¬å‘Šç±»å‹å®šä¹‰

| å…¬å‘Šç±»å‹ | è§¦å‘æ—¶æœº | å…¬å‘Šå†…å®¹ç¤ºä¾‹ |
|----------|----------|--------------|
| `game_start` | æ¸¸æˆå¼€å§‹ | "æ¬¢è¿æ¥åˆ°ç‹¼äººæ€æ¸¸æˆï¼æœ¬å±€å…±10åç©å®¶ï¼Œé…ç½®ä¸º3ç‹¼äºº..." |
| `night_start` | æ¯ä¸ªå¤œæ™šå¼€å§‹ | "å¤œå¹•é™ä¸´ï¼Œç¬¬Nå¤©çš„å¤œæ™šå¼€å§‹äº†ï¼Œæ‰€æœ‰ç©å®¶è¯·é—­çœ¼ã€‚" |
| `werewolf_action` | ç‹¼äººè¡ŒåŠ¨ | "ç‹¼äººè¯·ççœ¼ï¼Œè¯·å•†è®®ä»Šæ™šè¦å‡»æ€çš„ç›®æ ‡ã€‚" |
| `seer_action` | é¢„è¨€å®¶è¡ŒåŠ¨ | "ç‹¼äººè¯·é—­çœ¼ã€‚é¢„è¨€å®¶è¯·ççœ¼ï¼Œè¯·é€‰æ‹©è¦æŸ¥éªŒçš„ç©å®¶ã€‚" |
| `witch_action` | å¥³å·«è¡ŒåŠ¨ | "é¢„è¨€å®¶è¯·é—­çœ¼ã€‚å¥³å·«è¯·ççœ¼ï¼Œä»Šæ™šXå·ç©å®¶è¢«æ€ï¼Œæ˜¯å¦ä½¿ç”¨è§£è¯ï¼Ÿ" |
| `dawn` | å¤©äº® | "å¤©äº®äº†ï¼Œæ˜¨æ™šXå·ç©å®¶è¢«æ€å®³ã€‚" æˆ– "å¤©äº®äº†ï¼Œæ˜¨æ™šæ˜¯å¹³å®‰å¤œã€‚" |
| `discussion_start` | è®¨è®ºå¼€å§‹ | "è¯·å„ä½å­˜æ´»ç©å®¶ä¾æ¬¡å‘è¨€ï¼Œä»Xå·å¼€å§‹ã€‚" |
| `request_speech` | ç‚¹åå‘è¨€ | "è¯·Xå·ç©å®¶å‘è¨€ã€‚" |
| `vote_start` | æŠ•ç¥¨å¼€å§‹ | "å‘è¨€ç»“æŸï¼Œè¯·å„ä½ç©å®¶è¿›è¡ŒæŠ•ç¥¨ã€‚" |
| `vote_result` | æŠ•ç¥¨ç»“æœ | "æŠ•ç¥¨ç»“æŸï¼ŒXå·ç©å®¶ä»¥Nç¥¨è¢«æ”¾é€ã€‚" |
| `hunter_shoot` | çŒäººå¼€æª | "Xå·ç©å®¶æ˜¯çŒäººï¼Œå‘åŠ¨æŠ€èƒ½å¸¦èµ°äº†Yå·ç©å®¶ï¼" |
| `game_end` | æ¸¸æˆç»“æŸ | "æ¸¸æˆç»“æŸï¼ç‹¼äººé˜µè¥/å¥½äººé˜µè¥è·èƒœï¼ç‹¼äººæ˜¯..." |

### 3.2 WebSocket äº‹ä»¶ï¼ˆä¸»æŒäººç›¸å…³ï¼‰

#### 3.2.1 ä¸»æŒäººå…¬å‘Šäº‹ä»¶ï¼ˆæœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯ï¼‰

| äº‹ä»¶å | æ•°æ®ç»“æ„ | è¯´æ˜ |
|--------|----------|------|
| `werewolf:host_announcement` | `{ type, content, metadata }` | å®Œæ•´å…¬å‘Šï¼ˆéæµå¼ï¼‰ |
| `werewolf:host_announcement_start` | `{ type, metadata }` | æµå¼å…¬å‘Šå¼€å§‹ |
| `werewolf:host_announcement_chunk` | `{ type, chunk, accumulated }` | æµå¼å…¬å‘Šç‰‡æ®µ |
| `werewolf:host_announcement_end` | `{ type, content, metadata }` | æµå¼å…¬å‘Šç»“æŸ |

**metadata ç»“æ„**ï¼ˆæ ¹æ®å…¬å‘Šç±»å‹ï¼‰ï¼š
```typescript
// game_start
{ player_count: number, werewolf_count: number, role_config: string }

// dawn
{ dead_players: Array<{ seat_number, name, role? }>, is_peaceful: boolean }

// vote_result
{ vote_counts: Record<number, number>, eliminated?: { seat_number, name }, is_tie: boolean }

// request_speech
{ seat_number: number, player_name: string, is_human: boolean }

// game_end
{ winner: 'werewolf' | 'villager', werewolf_players: Array, good_players: Array, total_days: number }
```

### 3.3 WebSocket äº‹ä»¶ï¼ˆæ¸¸æˆæ§åˆ¶ï¼‰

#### 3.3.1 å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯

| äº‹ä»¶å | æ•°æ®ç»“æ„ | è¯´æ˜ |
|--------|----------|------|
| `werewolf:start_game` | `{ room_code: string }` | å¼€å§‹æ¸¸æˆ |
| `werewolf:pause_game` | `{ room_code: string }` | æš‚åœæ¸¸æˆ |
| `werewolf:resume_game` | `{ room_code: string }` | ç»§ç»­æ¸¸æˆ |
| `werewolf:player_speech` | `{ room_code: string, content: string }` | ç©å®¶å‘è¨€ |

#### 3.3.2 æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯

| äº‹ä»¶å | æ•°æ®ç»“æ„ | è¯´æ˜ |
|--------|----------|------|
| `werewolf:game_started` | `{ room_code, phase, day_number, players }` | æ¸¸æˆå·²å¼€å§‹ |
| `werewolf:game_paused` | `{ room_code }` | æ¸¸æˆå·²æš‚åœ |
| `werewolf:game_resumed` | `{ room_code }` | æ¸¸æˆå·²ç»§ç»­ |
| `werewolf:request_speech` | `{ player_id, seat_number, is_human }` | è¯·æ±‚ç©å®¶å‘è¨€ |
| `werewolf:speech_reminder` | `{ seat_number, message, count }` | å‘è¨€æé†’ |
| `werewolf:speech_start` | `{ speaker_seat, speaker_name, is_ai }` | å‘è¨€å¼€å§‹ |
| `werewolf:speech_chunk` | `{ speaker_seat, chunk, accumulated }` | å‘è¨€ç‰‡æ®µ |
| `werewolf:speech_end` | `{ speaker_seat, speaker_name, content }` | å‘è¨€ç»“æŸ |

### 3.2 REST APIï¼ˆå¢å¼ºï¼‰

#### POST /api/v1/werewolf/rooms/{room_code}/start

å¯åŠ¨æ¸¸æˆï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼Œä¸»è¦ä½¿ç”¨ WebSocketï¼‰

**Request Body:**
```json
{
  "player_id": "string"
}
```

**Response:**
```json
{
  "success": true,
  "message": "æ¸¸æˆå·²å¼€å§‹"
}
```

#### POST /api/v1/werewolf/rooms/{room_code}/pause

æš‚åœæ¸¸æˆ

**Request Body:**
```json
{
  "player_id": "string"
}
```

#### POST /api/v1/werewolf/rooms/{room_code}/resume

ç»§ç»­æ¸¸æˆ

#### POST /api/v1/werewolf/rooms/{room_code}/speech

ç©å®¶å‘è¨€

**Request Body:**
```json
{
  "player_id": "string",
  "content": "string"
}
```

#### GET /api/v1/werewolf/rooms/{room_code}/logs

è·å–æ¸¸æˆæ—¥å¿—ï¼ˆç”¨äºæ–­çº¿é‡è¿æ¢å¤ï¼‰

**Query Params:**
- `level`: `basic` | `detailed` (é»˜è®¤ basic)

**Response:**
```json
{
  "logs": [
    {
      "id": "string",
      "type": "speech | host_announcement | death | vote | ...",
      "player_id": "string?",
      "player_name": "string?",
      "content": "string",
      "day": 1,
      "phase": "night | day",
      "time": "ISO8601"
    }
  ]
}
```

## 4. æ•°æ®æ¨¡å‹è®¾è®¡

### 4.1 æ¸¸æˆçŠ¶æ€æ‰©å±• (WerewolfGameState)

```python
@dataclass
class WerewolfGameState:
    # ç°æœ‰å­—æ®µ...
    
    # æ–°å¢å­—æ®µ
    is_paused: bool = False                    # æ˜¯å¦æš‚åœ
    is_started: bool = False                   # æ˜¯å¦å·²å¼€å§‹
    current_speaker_seat: int | None = None    # å½“å‰å‘è¨€è€…åº§ä½
    waiting_for_player_input: bool = False     # æ˜¯å¦ç­‰å¾…ç©å®¶è¾“å…¥
    speech_reminder_count: int = 0             # å‘è¨€æé†’æ¬¡æ•°
    game_logs: list[GameLogEntry] = field(default_factory=list)  # å®Œæ•´æ—¥å¿—
```

### 4.2 æ¸¸æˆæ—¥å¿—æ¡ç›® (GameLogEntry)

```python
@dataclass
class GameLogEntry:
    id: str
    type: str                    # speech, host_announcement, death, vote, skill, etc.
    content: str
    day: int
    phase: str
    time: datetime
    player_id: str | None = None
    player_name: str | None = None
    seat_number: int | None = None
    metadata: dict | None = None  # é¢å¤–ä¿¡æ¯ï¼ˆå¦‚æŠ•ç¥¨ç»“æœã€æ­»äº¡åŸå› ç­‰ï¼‰
    is_public: bool = True       # æ˜¯å¦å…¬å¼€ï¼ˆç”¨äºæ—¥å¿—çº§åˆ«è¿‡æ»¤ï¼‰
```

### 4.3 å‰ç«¯çŠ¶æ€æ‰©å±• (game.js store)

```javascript
// æ–°å¢çŠ¶æ€
const isStarted = ref(false)           // æ¸¸æˆæ˜¯å¦å·²å¼€å§‹
const isPaused = ref(false)            // æ¸¸æˆæ˜¯å¦æš‚åœ
const canSpeak = ref(false)            // å½“å‰æ˜¯å¦å¯ä»¥å‘è¨€
const speechReminderVisible = ref(false) // å‘è¨€æé†’æ˜¯å¦å¯è§
const logLevel = ref('basic')          // æ—¥å¿—çº§åˆ«: 'basic' | 'detailed'

// AI å‘è¨€æ°”æ³¡çŠ¶æ€
const activeSpeechBubbles = ref({})    // { [seatNumber]: { content, isStreaming, timer } }
```

## 5. ç»„ä»¶è®¾è®¡

### 5.1 HostAnnouncementPanel ç»„ä»¶ï¼ˆå¢å¼ºï¼‰

**æ–‡ä»¶**: `frontend/src/components/werewolf/HostAnnouncementPanel.vue`

**åŠŸèƒ½**:
- æ¸¸æˆç•Œé¢å¸¸é©»çš„ä¸»æŒäººå‘è¨€å±•ç¤ºåŒº
- æ”¯æŒæµå¼è¾“å‡ºï¼ˆæ‰“å­—æœºæ•ˆæœï¼‰
- æ˜¾ç¤ºå…¬å‘Šç±»å‹æ ‡ç­¾
- å†å²å…¬å‘Šå¯æŠ˜å æŸ¥çœ‹

**ä¸ç°æœ‰ HostAnnouncement çš„åŒºåˆ«**:
- `HostAnnouncement.vue`: æ‚¬æµ®å¼¹çª—å½¢å¼ï¼Œç”¨äºé‡è¦å…¬å‘Š
- `HostAnnouncementPanel.vue`: å¸¸é©»é¢æ¿å½¢å¼ï¼ŒæŒç»­æ˜¾ç¤ºä¸»æŒäººçŠ¶æ€

**Props**:
```typescript
{
  currentAnnouncement: {
    type: string           // å…¬å‘Šç±»å‹
    content: string        // å…¬å‘Šå†…å®¹
    isStreaming: boolean   // æ˜¯å¦æ­£åœ¨æµå¼è¾“å‡º
  } | null
  announcementHistory: Array<{
    type: string
    content: string
    time: string
  }>
  collapsed: boolean       // å†å²æ˜¯å¦æŠ˜å 
}
```

**Events**:
```typescript
{
  'toggle-history': () => void
}
```

**å¸ƒå±€è®¾è®¡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ™ï¸ ä¸»æŒäºº                    [å†å² â–¼]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å¤œæ™šå¼€å§‹]                                â”‚
â”‚                                            â”‚
â”‚  å¤œå¹•é™ä¸´ï¼Œç¬¬1å¤©çš„å¤œæ™šå¼€å§‹äº†ï¼Œ             â”‚
â”‚  æ‰€æœ‰ç©å®¶è¯·é—­çœ¼ã€‚|                         â”‚
â”‚  (æ‰“å­—æœºå…‰æ ‡é—ªçƒ)                          â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 GameControlBar ç»„ä»¶ï¼ˆæ–°å¢ï¼‰

**æ–‡ä»¶**: `frontend/src/components/werewolf/GameControlBar.vue`

**åŠŸèƒ½**:
- æ˜¾ç¤º"å¼€å§‹æ¸¸æˆ"æŒ‰é’®ï¼ˆæ¸¸æˆæœªå¼€å§‹æ—¶ï¼‰
- æ˜¾ç¤º"æš‚åœ"/"ç»§ç»­"æŒ‰é’®ï¼ˆæ¸¸æˆè¿›è¡Œä¸­ï¼‰
- æ˜¾ç¤ºæš‚åœçŠ¶æ€æŒ‡ç¤º

**Props**:
```typescript
{
  isStarted: boolean
  isPaused: boolean
  isSpectator: boolean
  disabled: boolean
}
```

**Events**:
```typescript
{
  start: () => void
  pause: () => void
  resume: () => void
}
```

### 5.3 PlayerInputBar ç»„ä»¶ï¼ˆæ–°å¢ï¼‰

**æ–‡ä»¶**: `frontend/src/components/werewolf/PlayerInputBar.vue`

**åŠŸèƒ½**:
- å‘è¨€è¾“å…¥æ¡†
- å‘é€æŒ‰é’®
- ç¦ç”¨çŠ¶æ€æ˜¾ç¤ºï¼ˆ"ç­‰å¾…ä¸»æŒäººç‚¹å"ï¼‰
- å‘è¨€æé†’åŠ¨ç”»
- æ˜¾ç¤ºå½“å‰å‘è¨€è€…ä¿¡æ¯

**Props**:
```typescript
{
  disabled: boolean
  placeholder: string
  reminderVisible: boolean
  reminderCount: number      // æé†’æ¬¡æ•°
  currentSpeaker: {          // å½“å‰å‘è¨€è€…ï¼ˆä¸»æŒäººç‚¹åçš„ï¼‰
    seat_number: number
    name: string
    is_self: boolean         // æ˜¯å¦æ˜¯è‡ªå·±
  } | null
}
```

**Events**:
```typescript
{
  submit: (content: string) => void
}
```

**å¸ƒå±€è®¾è®¡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [å½“å‰: ä¸»æŒäººè¯·3å·ç©å®¶å‘è¨€]                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  è¯·è¾“å…¥ä½ çš„å‘è¨€...               â”‚  â”‚  å‘ é€   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                         â”‚
â”‚  ğŸ’¡ æç¤ºï¼šè¯·å‘è¨€ (å·²ç­‰å¾… 30ç§’)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 SpeechBubble ç»„ä»¶ï¼ˆæ–°å¢ï¼‰

**æ–‡ä»¶**: `frontend/src/components/werewolf/SpeechBubble.vue`

**åŠŸèƒ½**:
- æ˜¾ç¤ºå‘è¨€æ°”æ³¡
- æ”¯æŒæµå¼å†…å®¹ï¼ˆæ‰“å­—æœºæ•ˆæœï¼‰
- è‡ªåŠ¨æ¶ˆå¤±åŠ¨ç”»

**Props**:
```typescript
{
  content: string
  isStreaming: boolean
  position: 'top' | 'bottom' | 'left' | 'right'
  autoHide: boolean
  hideDelay: number  // é»˜è®¤ 5000ms
}
```

### 5.5 GameLog ç»„ä»¶å¢å¼º

**å¢å¼ºå†…å®¹**:
- æ·»åŠ æ—¥å¿—çº§åˆ«åˆ‡æ¢å¼€å…³
- æ”¯æŒåŸºç¡€/è¯¦ç»†ä¸¤ç§çº§åˆ«
- **ä¸»æŒäººå…¬å‘Šç‰¹æ®Šæ ·å¼**ï¼ˆç´«è‰²é«˜äº®ï¼‰
- **ç©å®¶å‘è¨€æ ·å¼**ï¼ˆç»¿è‰²é«˜äº®ï¼‰
- è¯¦ç»†çº§åˆ«æ˜¾ç¤º AI æ€è€ƒè¿‡ç¨‹

**æ—¥å¿—ç±»å‹ä¸æ ·å¼**:
| ç±»å‹ | æ ·å¼ | æ˜¾ç¤ºçº§åˆ« |
|------|------|----------|
| `host_announcement` | ç´«è‰²èƒŒæ™¯ï¼Œä¸»æŒäººå›¾æ ‡ | basic |
| `speech` | ç»¿è‰²è¾¹æ¡†ï¼Œç©å®¶åé«˜äº® | basic |
| `death` | çº¢è‰²èƒŒæ™¯ | basic |
| `vote` / `vote_result` | æ©™è‰²èƒŒæ™¯ | basic |
| `ai_thinking` | ç°è‰²ï¼Œæ–œä½“ | detailed |
| `skill` | è“è‰²èƒŒæ™¯ | basic |

### 5.6 PlayerSeat ç»„ä»¶å¢å¼º

**å¢å¼ºå†…å®¹**:
- é›†æˆ SpeechBubble ç»„ä»¶
- æ˜¾ç¤º AI/ç©å®¶ å‘è¨€æ°”æ³¡
- å‘è¨€ä¸­çŠ¶æ€åŠ¨ç”»å¢å¼º

**æ–°å¢ Props**:
```typescript
{
  speechBubble: {
    content: string
    isStreaming: boolean
    visible: boolean
  } | null
}
```

## 6. åç«¯æœåŠ¡è®¾è®¡

### 6.1 WerewolfHostï¼ˆä¸»æŒäººï¼‰å¢å¼º

**æ–‡ä»¶**: `backend/src/services/ai_agents/host/werewolf_host.py`

#### 6.1.1 æ–°å¢å…¬å‘Šæ–¹æ³•

```python
async def announce_request_speech(
    self,
    seat_number: int,
    player_name: str,
    is_human: bool,
    stream: bool = True
) -> AsyncIterator[str]:
    """
    ä¸»æŒäººç‚¹åç©å®¶å‘è¨€ã€‚
    
    :param seat_number: åº§ä½å·
    :param player_name: ç©å®¶åç§°
    :param is_human: æ˜¯å¦æ˜¯äººç±»ç©å®¶
    :param stream: æ˜¯å¦æµå¼è¾“å‡º
    :yields: å…¬å‘Šç‰‡æ®µ
    """
    pass

async def announce_player_speech_end(
    self,
    seat_number: int,
    player_name: str,
    stream: bool = False
) -> str:
    """
    ä¸»æŒäººç¡®è®¤ç©å®¶å‘è¨€ç»“æŸï¼ˆç®€çŸ­ï¼‰ã€‚
    """
    pass
```

#### 6.1.2 å…¬å‘Š Prompt æ¨¡æ¿æ–°å¢

```python
# host_prompts.py æ–°å¢

HOST_ANNOUNCEMENT_PROMPTS["request_speech"] = """
è¯·ä»¥ç‹¼äººæ€ä¸»æŒäººçš„èº«ä»½ï¼Œç‚¹å {seat_number}å·ç©å®¶ {player_name} å‘è¨€ã€‚
è¦æ±‚ï¼šç®€æ´ã€æ­£å¼ï¼Œ1-2å¥è¯å³å¯ã€‚
"""

HOST_ANNOUNCEMENT_PROMPTS["speech_end_transition"] = """
{seat_number}å·ç©å®¶å‘è¨€ç»“æŸï¼Œè¯·{next_seat_number}å·ç©å®¶å‘è¨€ã€‚
"""
```

### 6.2 WerewolfGameService å¢å¼º

**æ–‡ä»¶**: `backend/src/services/werewolf_game_service.py`

#### 6.2.1 æ¸¸æˆæ§åˆ¶æ–¹æ³•

```python
async def start_game_manual(self, room_code: str) -> bool:
    """
    æ‰‹åŠ¨å¼€å§‹æ¸¸æˆï¼ˆç”±ç”¨æˆ·è§¦å‘ï¼‰ã€‚
    
    æµç¨‹ï¼š
    1. åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€
    2. åˆ›å»º AI Agents
    3. ã€ä¸»æŒäººå…¬å‘Šã€‘æ¸¸æˆå¼€å§‹
    4. ã€ä¸»æŒäººå…¬å‘Šã€‘å¤œå¹•é™ä¸´
    5. å¼€å§‹å¤œæ™šè¡ŒåŠ¨
    """
    pass

async def pause_game(self, room_code: str) -> bool:
    """
    æš‚åœæ¸¸æˆï¼Œç­‰å¾…å½“å‰è¡ŒåŠ¨å®Œæˆï¼ˆå«ä¸»æŒäººå‘è¨€ï¼‰ã€‚
    """
    pass

async def resume_game(self, room_code: str) -> bool:
    """
    ç»§ç»­æ¸¸æˆï¼Œä¸»æŒäººç»§ç»­æµç¨‹ã€‚
    """
    pass
```

#### 6.2.2 ä¸»æŒäººé©±åŠ¨çš„è®¨è®ºæµç¨‹

```python
async def _execute_discussion_phase(self, room_code: str):
    """
    æ‰§è¡Œè®¨è®ºé˜¶æ®µï¼ˆä¸»æŒäººä¸»å¯¼ï¼‰ã€‚
    
    æµç¨‹ï¼š
    1. ã€ä¸»æŒäººå…¬å‘Šã€‘è®¨è®ºå¼€å§‹
    2. ä¾æ¬¡ç‚¹åå‘è¨€
       - ã€ä¸»æŒäººå…¬å‘Šã€‘è¯·Xå·ç©å®¶å‘è¨€
       - ç­‰å¾…ç©å®¶/AIå‘è¨€
       - å¹¿æ’­å‘è¨€å†…å®¹
    3. ã€ä¸»æŒäººå…¬å‘Šã€‘å‘è¨€ç»“æŸï¼Œå¼€å§‹æŠ•ç¥¨
    """
    pass

async def _request_player_speech(
    self, 
    room_code: str, 
    player_seat: int,
    player_name: str,
    is_human: bool
) -> None:
    """
    ä¸»æŒäººç‚¹åç©å®¶å‘è¨€ã€‚
    
    1. ã€ä¸»æŒäººå…¬å‘Šã€‘ç‚¹åå‘è¨€ï¼ˆæµå¼ï¼‰
    2. å¹¿æ’­ request_speech äº‹ä»¶
    3. å¦‚æœæ˜¯äººç±»ç©å®¶ï¼Œç­‰å¾…è¾“å…¥
    4. å¦‚æœæ˜¯ AIï¼Œè§¦å‘ AI å‘è¨€
    """
    pass

async def _wait_for_human_speech(
    self,
    room_code: str,
    player_seat: int
) -> str:
    """
    ç­‰å¾…äººç±»ç©å®¶å‘è¨€ï¼ˆæ— è¶…æ—¶ï¼‰ã€‚
    
    åŠŸèƒ½ï¼š
    - è®¾ç½® waiting_for_player_input = True
    - å¯åŠ¨æé†’ä»»åŠ¡ï¼ˆæ¯30ç§’æé†’ä¸€æ¬¡ï¼‰
    - ç­‰å¾… player_speech äº‹ä»¶
    - è¿”å›å‘è¨€å†…å®¹
    """
    pass

async def _send_speech_reminder(
    self, 
    room_code: str, 
    player_seat: int,
    count: int
) -> None:
    """
    å‘é€å‘è¨€æé†’ï¼ˆæ¯30ç§’ï¼‰ã€‚
    """
    pass
```

#### 6.2.3 ç©å®¶å‘è¨€å¤„ç†ä¸ AI ä¸Šä¸‹æ–‡

```python
async def process_player_speech(
    self,
    room_code: str,
    player_id: str,
    content: str
) -> None:
    """
    å¤„ç†ç©å®¶å‘è¨€ï¼š
    1. éªŒè¯æ˜¯å¦è½®åˆ°è¯¥ç©å®¶å‘è¨€
    2. è®°å½•å‘è¨€åˆ°æ—¥å¿—
    3. å¹¿æ’­å‘è¨€ï¼ˆå«æ°”æ³¡æ˜¾ç¤ºï¼‰
    4. æ›´æ–°æ‰€æœ‰ AI Agent çš„ä¸Šä¸‹æ–‡
    5. ç»§ç»­æ¸¸æˆæµç¨‹ï¼ˆä¸»æŒäººç‚¹åä¸‹ä¸€ä½ï¼‰
    """
    pass

def _build_ai_context(
    self, 
    game_state: WerewolfGameState,
    agent_seat: int,
    current_round_speeches: list[dict]
) -> dict:
    """
    ä¸º AI Agent æ„å»ºä¸Šä¸‹æ–‡ã€‚
    
    åŒ…å«ï¼š
    - æ¸¸æˆå†å²æ—¥å¿—
    - å½“å¤©æ‰€æœ‰å…¬å¼€å‘è¨€ï¼ˆå«ç©å®¶å‘è¨€ï¼‰
    - ä¸»æŒäººå…¬å‘Šæ‘˜è¦
    - å­˜æ´»ç©å®¶ä¿¡æ¯
    - æœ¬è½®å·²æœ‰å‘è¨€ï¼ˆç”¨äºè¿è´¯è®¨è®ºï¼‰
    """
    pass
```

#### 6.2.4 ä¸»æŒäººå…¬å‘Šå¹¿æ’­

```python
async def _broadcast_host_announcement(
    self,
    room_code: str,
    announcement_type: str,
    metadata: dict | None = None
) -> None:
    """
    å¹¿æ’­ä¸»æŒäººå…¬å‘Šï¼ˆæµå¼ï¼‰ã€‚
    
    1. è°ƒç”¨ WerewolfHost ç”Ÿæˆå…¬å‘Š
    2. å‘é€ announcement_start
    3. å¾ªç¯å‘é€ announcement_chunk
    4. å‘é€ announcement_end
    5. è®°å½•åˆ°æ¸¸æˆæ—¥å¿—
    """
    pass
```

### 6.3 WebSocket Handlers å¢å¼º

**æ–‡ä»¶**: `backend/src/websocket/werewolf_handlers.py`

æ–°å¢äº‹ä»¶å¤„ç†å™¨ï¼š

```python
@sio.event
async def werewolf_start_game(sid: str, data: dict):
    """
    å¤„ç†å¼€å§‹æ¸¸æˆäº‹ä»¶ã€‚
    
    è§¦å‘ WerewolfGameService.start_game_manual()
    """
    pass

@sio.event
async def werewolf_pause_game(sid: str, data: dict):
    """å¤„ç†æš‚åœæ¸¸æˆäº‹ä»¶ã€‚"""
    pass

@sio.event
async def werewolf_resume_game(sid: str, data: dict):
    """å¤„ç†ç»§ç»­æ¸¸æˆäº‹ä»¶ã€‚"""
    pass

@sio.event
async def werewolf_player_speech(sid: str, data: dict):
    """
    å¤„ç†ç©å®¶å‘è¨€äº‹ä»¶ã€‚
    
    è§¦å‘ WerewolfGameService.process_player_speech()
    """
    pass
```

### 6.4 AI Agent ä¸Šä¸‹æ–‡å¢å¼º

**æ–‡ä»¶**: `backend/src/services/ai_agents/*.py`

åœ¨å„ AI Agentï¼ˆWerewolfAgent, SeerAgent, VillagerAgent ç­‰ï¼‰ä¸­å¢å¼ºï¼š

```python
def update_context(self, speeches: list[dict]) -> None:
    """
    æ›´æ–°å¯¹è¯ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«ç©å®¶å‘è¨€ã€‚
    
    :param speeches: å½“è½®å‘è¨€åˆ—è¡¨
        [{ seat: int, name: str, content: str, is_human: bool }]
    """
    pass

async def generate_speech_stream(
    self,
    game_history: list[str],
    alive_players: list[int],
    day_number: int,
    current_round_speeches: list[dict],  # æ–°å¢ï¼šå½“è½®å‘è¨€ï¼ˆå«ç©å®¶ï¼‰
    host_context: str | None = None       # æ–°å¢ï¼šä¸»æŒäººä¸Šä¸‹æ–‡
) -> AsyncGenerator[str, None]:
    """
    ç”Ÿæˆå‘è¨€ï¼ˆæµå¼ï¼‰ï¼Œè€ƒè™‘ç©å®¶å‘è¨€å’Œä¸»æŒäººå¼•å¯¼ã€‚
    """
    pass
```

## 7. å®ç°ä»»åŠ¡æ¸…å•

### 7.1 åç«¯ä»»åŠ¡ - ä¸»æŒäººä¸æ¸¸æˆæ§åˆ¶

| # | ä»»åŠ¡ | æ–‡ä»¶ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|---|------|------|--------|------|
| B1 | å¢åŠ æ¸¸æˆçŠ¶æ€å­—æ®µ | `werewolf_engine.py` | P0 | æ·»åŠ  is_paused, is_started, current_speaker ç­‰ |
| B2 | **ä¸»æŒäººç‚¹åå‘è¨€æ–¹æ³•** | `host/werewolf_host.py` | P0 | æ–°å¢ announce_request_speech() æ–¹æ³• |
| B3 | **ä¸»æŒäººå…¬å‘Šå¹¿æ’­æ–¹æ³•** | `werewolf_game_service.py` | P0 | å®ç° _broadcast_host_announcement() |
| B4 | å®ç° start_game_manual æ–¹æ³• | `werewolf_game_service.py` | P0 | è§¦å‘ä¸»æŒäººæ¸¸æˆå¼€å§‹å…¬å‘Š |
| B5 | å®ç° pause_game/resume_game | `werewolf_game_service.py` | P0 | ç­‰å¾…å½“å‰ä¸»æŒäººå‘è¨€å®Œæˆåæš‚åœ |
| B6 | **ä¸»æŒäººé©±åŠ¨è®¨è®ºæµç¨‹** | `werewolf_game_service.py` | P0 | å®ç° _execute_discussion_phase() ä¸»æŒäººç‚¹åé€»è¾‘ |
| B7 | ç©å®¶å‘è¨€å¤„ç†å’Œä¸Šä¸‹æ–‡æ„å»º | `werewolf_game_service.py` | P0 | process_player_speech(), _build_ai_context() |
| B8 | å¢å¼º host_announcement äº‹ä»¶ | `werewolf_handlers.py` | P0 | æ·»åŠ  announcement_type, metadata å­—æ®µ |
| B9 | æ–°å¢ WebSocket äº‹ä»¶å¤„ç†å™¨ | `werewolf_handlers.py` | P0 | start_game, pause_game, player_speech ç­‰ |
| B10 | æ–°å¢æ—¥å¿—è·å– APIï¼ˆæ–­çº¿é‡è¿ï¼‰ | `werewolf_routes.py` | P0 | åŒ…å«ä¸»æŒäººå…¬å‘Šå†å² |
| B11 | å®ç°å‘è¨€æé†’æœºåˆ¶ | `werewolf_game_service.py` | P1 | æ¯30ç§’æé†’ï¼Œç”±ä¸»æŒäººé£æ ¼å‘é€ |

### 7.2 å‰ç«¯ä»»åŠ¡ - ä¸»æŒäººå±•ç¤º

| # | ä»»åŠ¡ | æ–‡ä»¶ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|---|------|------|--------|------|
| F1 | **åˆ›å»º HostAnnouncementPanel** | `werewolf/HostAnnouncementPanel.vue` | P0 | å¸¸é©»ä¸»æŒäººé¢æ¿ï¼ŒåŒºåˆ«äºå¼¹çª— |
| F2 | **åˆ›å»º HostAvatar ç»„ä»¶** | `werewolf/HostAvatar.vue` | P1 | ä¸»æŒäººå¤´åƒï¼Œè¯´è¯æ—¶æœ‰åŠ¨ç”» |
| F3 | åˆ›å»º GameControlBar ç»„ä»¶ | `werewolf/GameControlBar.vue` | P0 | å¼€å§‹/æš‚åœ/ç»§ç»­æŒ‰é’® |
| F4 | åˆ›å»º PlayerInputBar ç»„ä»¶ | `werewolf/PlayerInputBar.vue` | P0 | æ˜¾ç¤ºä¸»æŒäººç‚¹åæç¤º |
| F5 | åˆ›å»º SpeechBubble ç»„ä»¶ | `werewolf/SpeechBubble.vue` | P0 | AI/ç©å®¶å‘è¨€æ°”æ³¡ |
| F6 | å¢å¼º GameLog ç»„ä»¶ | `werewolf/GameLog.vue` | P0 | ä¸»æŒäººå…¬å‘Šç‰¹æ®Šæ ·å¼ï¼ˆç´«è‰²é«˜äº®ï¼‰ |
| F7 | å¢å¼º PlayerSeat ç»„ä»¶ | `werewolf/PlayerSeat.vue` | P0 | é›†æˆ SpeechBubble |
| F8 | æ›´æ–° WerewolfGameView | `views/WerewolfGameView.vue` | P0 | é›†æˆæ‰€æœ‰æ–°ç»„ä»¶ï¼Œå¸ƒå±€è°ƒæ•´ |
| F9 | å¢å¼º game store | `stores/game.js` | P0 | ä¸»æŒäººçŠ¶æ€ã€å½“å‰å‘è¨€è€…çŠ¶æ€ |
| F10 | å¢å¼º socket store | `stores/socket.js` | P0 | ä¸»æŒäººå…¬å‘Šäº‹ä»¶å¤„ç†å¢å¼º |
| F11 | å®ç°æ–­çº¿é‡è¿æ—¥å¿—æ¢å¤ | `views/WerewolfGameView.vue` | P0 | åŒ…å«ä¸»æŒäººå…¬å‘Šå†å²å›æ”¾ |
| F12 | å®ç°å‘è¨€æé†’åŠ¨ç”» | `werewolf/PlayerInputBar.vue` | P1 | ä¸»æŒäººæé†’æ ·å¼ |

### 7.3 ä»»åŠ¡ä¾èµ–å…³ç³»

```
ä¸»æŒäººç›¸å…³ä»»åŠ¡ä¾èµ–é“¾ï¼š

B2 (ä¸»æŒäººç‚¹åæ–¹æ³•) â”€â”¬â”€â†’ B3 (ä¸»æŒäººå…¬å‘Šå¹¿æ’­) â”€â†’ B6 (ä¸»æŒäººé©±åŠ¨è®¨è®º)
                    â”‚
                    â””â”€â†’ B8 (announcementäº‹ä»¶å¢å¼º)
                                â”‚
                                â–¼
                        F1 (HostAnnouncementPanel) â”€â†’ F6 (GameLogå¢å¼º)
                                â”‚
                                â””â”€â†’ F9 (game storeä¸»æŒäººçŠ¶æ€)

ç©å®¶äº¤äº’ä»»åŠ¡ä¾èµ–é“¾ï¼š

B6 (ä¸»æŒäººé©±åŠ¨è®¨è®º) â”€â†’ B7 (ç©å®¶å‘è¨€å¤„ç†) â”€â†’ B9 (WebSocketäº‹ä»¶)
                                â”‚
                                â–¼
                        F4 (PlayerInputBar) â”€â†’ F5 (SpeechBubble)
```

## 8. å…³é”®å®ç°ç»†èŠ‚

### 8.1 æš‚åœæœºåˆ¶å®ç°

```python
# werewolf_game_service.py

async def pause_game(self, room_code: str) -> bool:
    """æš‚åœæ¸¸æˆ"""
    game_state = self._game_states.get(room_code)
    if not game_state or game_state.is_paused:
        return False
    
    # æ ‡è®°æš‚åœï¼ˆå½“å‰è¡ŒåŠ¨å®Œæˆåç”Ÿæ•ˆï¼‰
    game_state.is_paused = True
    
    # å¹¿æ’­æš‚åœäº‹ä»¶
    await sio.emit('werewolf:game_paused', {'room_code': room_code}, room=room_code)
    
    return True

async def _check_paused_before_next_action(self, room_code: str) -> bool:
    """åœ¨æ‰§è¡Œä¸‹ä¸€ä¸ªè¡ŒåŠ¨å‰æ£€æŸ¥æ˜¯å¦æš‚åœ"""
    game_state = self._game_states.get(room_code)
    if game_state and game_state.is_paused:
        # ç­‰å¾…ç»§ç»­ä¿¡å·
        while game_state.is_paused:
            await asyncio.sleep(0.5)
    return True
```

### 8.2 ç©å®¶å‘è¨€ä¸ AI ä¸Šä¸‹æ–‡

```python
# werewolf_game_service.py

async def _execute_speeches_with_player(self, room_code: str):
    """æ‰§è¡Œå‘è¨€æµç¨‹ï¼ˆå«ç©å®¶å‘è¨€ï¼‰"""
    game_state = self._game_states.get(room_code)
    alive_players = sorted(
        [p for p in game_state.players.values() if p.is_alive],
        key=lambda p: p.seat_number
    )
    
    # æ”¶é›†å½“è½®å‘è¨€ä½œä¸º AI ä¸Šä¸‹æ–‡
    current_round_speeches = []
    
    for player in alive_players:
        await self._check_paused_before_next_action(room_code)
        
        if player.seat_number in self._ai_agents:
            # AI å‘è¨€
            agent = self._ai_agents[player.seat_number]
            speech_content = await self._execute_ai_speech_streaming(
                room_code, player, agent, current_round_speeches
            )
            current_round_speeches.append({
                'seat': player.seat_number,
                'content': speech_content,
                'is_ai': True
            })
        else:
            # äººç±»ç©å®¶å‘è¨€
            speech_content = await self._wait_for_player_speech(room_code, player)
            current_round_speeches.append({
                'seat': player.seat_number,
                'content': speech_content,
                'is_ai': False
            })
```

### 8.3 AI å‘è¨€æ°”æ³¡å‰ç«¯å®ç°

```vue
<!-- PlayerSeat.vue å¢å¼º -->
<template>
  <div class="cyber-player-seat" ...>
    <!-- ç°æœ‰å†…å®¹ -->
    
    <!-- å‘è¨€æ°”æ³¡ -->
    <SpeechBubble
      v-if="speechBubble?.visible"
      :content="speechBubble.content"
      :is-streaming="speechBubble.isStreaming"
      :position="bubblePosition"
      :auto-hide="!speechBubble.isStreaming"
      :hide-delay="5000"
      @hidden="$emit('bubble-hidden')"
    />
  </div>
</template>
```

```vue
<!-- SpeechBubble.vue -->
<template>
  <Transition name="bubble">
    <div 
      v-show="visible"
      class="speech-bubble"
      :class="[`position-${position}`]"
    >
      <div class="bubble-content">
        <span class="bubble-text">{{ content }}</span>
        <span v-if="isStreaming" class="typing-cursor">|</span>
      </div>
      <div class="bubble-arrow"></div>
    </div>
  </Transition>
</template>
```

### 8.4 æ—¥å¿—çº§åˆ«åˆ‡æ¢

```vue
<!-- GameLog.vue å¢å¼º -->
<template>
  <div class="game-log">
    <div class="log-header">
      <h3 class="log-title">æ¸¸æˆæ—¥å¿—</h3>
      <div class="log-controls">
        <el-switch
          v-model="isDetailedMode"
          active-text="è¯¦ç»†"
          inactive-text="åŸºç¡€"
          size="small"
          @change="handleLevelChange"
        />
        <!-- å…¶ä»–æ§åˆ¶ -->
      </div>
    </div>
    
    <div class="log-content">
      <template v-for="entry in filteredLogs" :key="entry.id">
        <!-- æ ¹æ®æ—¥å¿—ç±»å‹æ¸²æŸ“ -->
      </template>
    </div>
  </div>
</template>

<script setup>
const filteredLogs = computed(() => {
  if (props.logLevel === 'basic') {
    return props.logs.filter(log => log.is_public !== false)
  }
  return props.logs
})
</script>
```

## 9. æµ‹è¯•è®¡åˆ’

### 9.1 å•å…ƒæµ‹è¯•

| æµ‹è¯•é¡¹ | æ–‡ä»¶ | è¯´æ˜ |
|--------|------|------|
| æ¸¸æˆå¼€å§‹æ§åˆ¶ | `tests/unit/test_werewolf_game_control.py` | æµ‹è¯•å¼€å§‹æ¸¸æˆé€»è¾‘ |
| æš‚åœ/ç»§ç»­é€»è¾‘ | `tests/unit/test_werewolf_pause.py` | æµ‹è¯•æš‚åœçŠ¶æ€ç®¡ç† |
| ç©å®¶å‘è¨€å¤„ç† | `tests/unit/test_player_speech.py` | æµ‹è¯•å‘è¨€éªŒè¯å’Œå¹¿æ’­ |
| AI ä¸Šä¸‹æ–‡æ„å»º | `tests/unit/test_ai_context.py` | æµ‹è¯•ä¸Šä¸‹æ–‡åŒ…å«ç©å®¶å‘è¨€ |

### 9.2 é›†æˆæµ‹è¯•

| æµ‹è¯•é¡¹ | æ–‡ä»¶ | è¯´æ˜ |
|--------|------|------|
| å®Œæ•´æ¸¸æˆæµç¨‹ | `tests/integration/test_werewolf_full_game.py` | å«å¼€å§‹ã€æš‚åœã€å‘è¨€çš„å®Œæ•´æµç¨‹ |
| WebSocket äº‹ä»¶ | `tests/integration/test_werewolf_ws_events.py` | æµ‹è¯•æ‰€æœ‰æ–°å¢ WebSocket äº‹ä»¶ |

### 9.3 å‰ç«¯æµ‹è¯•

| æµ‹è¯•é¡¹ | æ–‡ä»¶ | è¯´æ˜ |
|--------|------|------|
| GameControlBar | `tests/unit/components/GameControlBar.spec.js` | æŒ‰é’®çŠ¶æ€å’Œäº‹ä»¶ |
| PlayerInputBar | `tests/unit/components/PlayerInputBar.spec.js` | è¾“å…¥å’Œç¦ç”¨çŠ¶æ€ |
| SpeechBubble | `tests/unit/components/SpeechBubble.spec.js` | æ°”æ³¡æ˜¾ç¤ºå’ŒåŠ¨ç”» |
| GameLog å¢å¼º | `tests/unit/components/GameLog.spec.js` | æ—¥å¿—çº§åˆ«åˆ‡æ¢ |

## 10. é£é™©ä¸ç¼“è§£

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| æš‚åœæ—¶æœºä¸å‡†ç¡® | ç”¨æˆ·ä½“éªŒå·® | ä½¿ç”¨å¼‚æ­¥é”ç¡®ä¿å½“å‰è¡ŒåŠ¨å®Œæˆåå†æš‚åœ |
| å‘è¨€æ°”æ³¡é®æŒ¡ç•Œé¢ | ä¿¡æ¯å±•ç¤ºé—®é¢˜ | ä½¿ç”¨æ™ºèƒ½å®šä½ï¼Œæ ¹æ®åº§ä½ä½ç½®é€‰æ‹©æ°”æ³¡æ–¹å‘ |
| æ–­çº¿é‡è¿ä¸¢å¤±æ—¥å¿— | ç©å®¶é”™è¿‡é‡è¦ä¿¡æ¯ | å®ç°æ—¥å¿— APIï¼Œé‡è¿æ—¶æ‹‰å–å†å²æ—¥å¿— |
| AI ä¸Šä¸‹æ–‡è¿‡é•¿ | LLM è°ƒç”¨è¶…æ—¶ | é™åˆ¶ä¸Šä¸‹æ–‡é•¿åº¦ï¼Œåªä¿ç•™å½“å¤©å‘è¨€ |

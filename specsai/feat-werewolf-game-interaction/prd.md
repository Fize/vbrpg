# 狼人杀游戏交互增强 - 需求规格文档

## 1. 项目概述

### 1.1 项目背景
- **项目起源**：当前狼人杀游戏界面进入后不会自动开始游戏，玩家无法有效控制游戏进度，且缺乏实时的游戏交互体验
- **核心问题**：
  - 游戏进入后需要手动操作才能开始，流程不够流畅
  - 玩家无法控制游戏的暂停和继续
  - 游戏日志无法实时展示AI对话内容和游戏进度
  - 玩家角色无法与AI进行发言交互
  - AI发言时缺乏直观的视觉反馈
- **项目愿景**：提供流畅、沉浸式的狼人杀游戏体验，让玩家能够实时参与游戏并与AI角色进行自然交互

### 1.2 业务价值
- **业务目标**：提升狼人杀游戏的可玩性和用户参与度
- **预期价值**：
  - 提高用户游戏体验满意度
  - 增强游戏的沉浸感和趣味性
  - 使单人游戏模式更加完整可用
- **成功指标**：
  - 玩家能够顺利完成完整的狼人杀游戏流程
  - 游戏交互响应及时，AI发言实时可见
  - 玩家发言功能正常工作

### 1.3 项目范围
- **包含范围**：
  - 游戏手动开始功能
  - 游戏暂停/继续控制功能
  - 实时游戏日志显示
  - 玩家发言输入功能
  - AI发言气泡实时显示
- **排除范围**：
  - 游戏规则逻辑变更
  - 新角色或新游戏模式添加
  - 后端AI决策逻辑优化
- **交付物**：
  - 更新后的狼人杀游戏界面
  - 完整的游戏交互功能

## 2. 利益相关者分析

### 2.1 用户群体
- **主要用户**：单人模式下体验狼人杀游戏的玩家
- **次要用户**：观众模式下观看AI对战的用户
- **用户画像**：希望体验狼人杀游戏但缺少足够玩家的桌游爱好者，通过与AI对战来享受游戏乐趣

### 2.2 使用场景
- **主要场景**：玩家以角色身份进入游戏，与AI玩家一起进行狼人杀游戏
- **次要场景**：玩家以观众身份观看AI之间的狼人杀对战
- **边界场景**：网络不稳定时的断线重连场景
  - 断线重连后需要回放全部历史游戏日志，确保玩家不错过任何游戏进展

## 3. 功能需求

### 3.1 核心功能领域

#### P0 - 必须实现的核心功能

**功能领域1：游戏开始控制**
- **业务价值**：让玩家在准备好后主动开始游戏，确保玩家有充足时间了解游戏设置
- **关键用户故事**：
  作为一名狼人杀玩家，我希望在进入游戏界面后，能够通过点击"开始游戏"按钮来启动游戏，这样我可以在准备好之后再开始游戏。
- **验收标准**：
  - 游戏界面显示明显的"开始游戏"按钮
  - 点击按钮后游戏立即开始
  - 游戏开始后按钮消失或变为禁用状态
  - 如果玩家是观众模式，同样提供开始按钮

**功能领域2：游戏进度控制（暂停/继续）**
- **业务价值**：允许玩家在需要时暂停游戏，便于思考或处理临时事务，提升游戏灵活性
- **关键用户故事**：
  作为一名狼人杀玩家，我希望能够随时暂停和继续游戏，这样我可以在需要时中断游戏而不影响进度。
- **验收标准**：
  - 游戏进行中显示"暂停"按钮
  - 点击"暂停"后，等待当前行动完成后再暂停游戏（不中断正在进行的AI发言）
  - 暂停后AI不再进行下一步行动
  - 暂停状态下按钮变为"继续"
  - 点击"继续"后游戏恢复进行
  - 所有玩家（包括观众模式）都可以控制暂停/继续
  - 暂停状态有明显的视觉提示

**功能领域3：实时游戏日志**
- **业务价值**：让玩家实时了解游戏进展和AI的发言内容，增强游戏的可观察性和趣味性
- **关键用户故事**：
  作为一名狼人杀玩家，我希望在游戏日志区域能够实时看到游戏的进度信息和AI的对话内容，这样我可以跟踪游戏发展并做出决策。
- **验收标准**：
  - 游戏日志区域实时更新游戏事件（如：夜晚开始、某玩家被淘汰等）
  - AI发言内容实时显示在日志中
  - 日志内容按时间顺序排列，最新内容在最下方
  - 日志自动滚动到最新内容
  - 支持可配置的日志显示级别（在游戏界面提供实时切换开关）：
    - 基础级别：仅公开发言和游戏事件
    - 详细级别：包含AI思考过程（调试模式）
  - 日志内容有清晰的格式区分（系统消息、玩家发言、AI发言等）

**功能领域4：玩家发言输入**
- **业务价值**：让玩家能够以游戏角色身份发言，真正参与到游戏中与AI交互
- **关键用户故事**：
  作为一名以角色身份加入的狼人杀玩家，我希望在主持人要求我发言时，能够通过输入框输入我的发言内容与AI玩家交互，这样我可以参与游戏讨论和策略。
- **验收标准**：
  - 游戏界面提供发言输入框
  - 发言输入框根据游戏阶段动态启用/禁用：
    - 只有在主持人要求该玩家发言时才能输入
    - 非发言时段输入框显示禁用状态，并提示"等待发言时机"
  - 输入内容后可通过按钮或回车键提交发言
  - 发言提交后显示在游戏日志中
  - 发言内容会被AI玩家接收并可能影响其决策
  - 观众模式下不显示发言输入框
  - 玩家发言无字数限制
  - 玩家发言无超时限制，可一直等待玩家输入
  - 等待玩家发言时，每隔一段时间显示提醒（如"请发言"提示）

**功能领域5：AI发言气泡显示**
- **业务价值**：通过视觉化的发言气泡，增强游戏的沉浸感和角色代入感
- **关键用户故事**：
  作为一名狼人杀玩家，我希望当AI角色发言时，能够在其头像/座位旁边看到实时的对话气泡，这样我可以直观地知道是谁在说话以及说了什么。
- **验收标准**：
  - AI发言时，在对应角色的座位/头像旁显示对话气泡
  - 对话气泡内容实时显示（支持打字机效果的流式输出）
  - 对话气泡显示固定时间后自动消失（5秒）
  - 气泡样式清晰，不遮挡重要游戏信息
  - 多个AI同时发言时（如狼人夜间交流），各自显示独立气泡

### 3.2 功能依赖关系
- **前置依赖**：
  - 游戏开始控制功能是其他所有功能的前置条件
  - 玩家发言功能依赖于游戏阶段判断逻辑
- **后置影响**：
  - AI发言气泡功能增强了游戏日志的视觉表现
- **实现顺序**：
  1. 游戏开始控制
  2. 游戏进度控制（暂停/继续）
  3. 实时游戏日志
  4. AI发言气泡显示
  5. 玩家发言输入

## 4. 非功能性需求

### 4.1 用户体验需求
- **易用性**：按钮和输入框位置直观，操作简单明了
- **学习成本**：新功能无需额外学习，符合用户直觉
- **界面偏好**：保持与现有游戏界面风格一致

### 4.2 性能需求
- **响应时间**：
  - 点击开始/暂停/继续按钮后，界面响应时间 < 500ms
  - AI发言气泡显示延迟 < 200ms
  - 日志更新延迟 < 300ms
- **数据处理**：流式输出AI发言内容，避免长时间等待

## 5. 风险评估

### 5.1 业务风险
- **中等风险项**：
  - 玩家发言时机判断可能不够准确，导致用户困惑
  - AI发言气泡可能在特定情况下遮挡重要信息

### 5.2 用户接受度风险
- **用户适应性**：新增功能符合用户预期，适应风险低
- **迁移成本**：无迁移成本，为纯新增功能

### 5.3 风险应对策略
- **缓解计划**：
  - 发言输入框显示明确的状态提示
  - AI发言气泡设置合理的显示位置和大小
  - 提供日志显示级别配置，满足不同用户需求

## 6. 成功标准

### 6.1 业务成功指标
- **核心指标**：
  - 玩家能够完整体验狼人杀游戏全流程
  - 游戏交互功能100%可用

### 6.2 用户满意度指标
- **满意度目标**：功能使用流畅，无明显卡顿或延迟
- **使用率目标**：所有进入游戏的玩家都能使用这些功能

### 6.3 项目完成标准
- **功能完整**：
  - 5个核心功能领域全部实现
  - 所有验收标准通过验证
- **质量达标**：
  - 无阻塞性或严重bug
  - 响应时间满足性能需求
- **用户验收**：
  - 完成一局完整的狼人杀游戏测试
  - 所有交互功能正常工作

## 7. 依赖关系

### 7.1 内部依赖
- **技术依赖**：
  - 现有的狼人杀游戏引擎（werewolf_engine.py）
  - WebSocket实时通信机制
  - 现有的游戏界面组件（WerewolfGameView.vue）

### 7.2 外部依赖
- **第三方服务**：
  - LLM服务用于AI发言生成

## 8. 优先级排序
- **功能优先级**：
  1. P0 - 游戏开始控制
  2. P0 - 游戏进度控制（暂停/继续）
  3. P0 - 实时游戏日志
  4. P0 - AI发言气泡显示
  5. P0 - 玩家发言输入
- **交付顺序**：按优先级顺序依次交付，确保核心游戏流程优先可用
